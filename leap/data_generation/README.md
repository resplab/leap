# Data Generation

In this module, we generate the datasets used for the `LEAP` model. This only needs to be
run once, and in general, users may ignore this folder. It is mainly for developers to reference
and update if new data needs to be added.

## Birth Data

To obtain the population data for each year, we used two tables from `StatCan`:

1. 1999 - 2021

For past years, we used 
[Table 17-10-00005-01 from StatCan](https://www150.statcan.gc.ca/t1/tbl1/en/cv.action?pid=1710000501).

The `*.csv` file can be downloaded from here:
[17100005-eng.zip](https://www150.statcan.gc.ca/n1/tbl/csv/17100005-eng.zip)

and is saved as:
`LEAP/leap/original_data/17100005.csv`

2. 2021 - 2065:

For future years, we used
[Table 17-10-0057-01 from StatCan](https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1710005701).

The `*.csv` file can be downloaded from here:
[17100057-eng.zip](https://www150.statcan.gc.ca/n1/tbl/csv/17100057-eng.zip).

and is saved as:
`LEAP/leap/original_data/17100057.csv`


To run the data processing for the population data:

```sh
cd LEAP
python3 leap/data_generation/birth_data.py
```

This will update the following data files: 

1. `leap/processed_data/birth/birth_estimate.csv`
2. `leap/processed_data/birth/initial_pop_distribution_prop.csv`

## Death Data

To obtain the mortality data for each year, we used one table from `StatCan`:

1. 1996 - 2021

For past years, we used
[Table 13-10-00837-01 from StatCan](https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1310083701).

The `*.csv` file can be downloaded from here:
[13100837-eng.zip](https://www150.statcan.gc.ca/n1/tbl/csv/13100837-eng.zip).

and is saved as:
`LEAP/leap/original_data/13100837.csv`

2. 2021 - 2068

TODO.

To run the data generation for the mortality data:

```sh
cd LEAP
python3 leap/data_generation/death_data.py
```

This will update the following data file: 

1. `leap/processed_data/life_table.csv`

## Migration Data

`StatCan` does not contain immigration/emigration data broken down by the necessary
groups (age, sex, etc), so we do not have exact data for this category. Instead, we use the
following data files:

1. `leap/processed_data/life_table.csv` (generated by `death_data.py`)
2. `leap/processed_data/birth/initial_pop_distribution_prop.csv` (generated by `birth_data.py`)

The `life_table.csv` contains the probability of death during that year for each age, sex, province,
and projection scenario.

The `initial_pop_distribution_prop.csv` contains the number of people in a given age, sex, province,
and projection scenario, along with the number of births for that year. This data is the net number
of people, factoring in death, immigration, and emigration.

To obtain the net migration, for anyone aged > 0, we compute the number of people in each age
group projected to die during that year based on the `prob_death` column in the `life_table.csv`.
Then we calculate the net change in people using the `n_age` column in the
`initial_pop_distribution_prop.csv`. We subtract the number of people who died from the net
population change to get the net number of people who migrated:

```python
delta_n = n - n_prev * (1 - prob_death)
```

**TODO**: The next part of the calculation is incorrect. `delta_N` is the change in population due
to migration. This model currently assumes that if `delta_N < 0`, 100% of migration is
emigration, and if `delta_N > 0`, 100% of migration is immigration. This has
led to the data being very inaccurate (for example, it appears as though people in their
90s are emigrating a lot and people in their 20s are not). This will be remedied in a
separate PR.


To run the data generation for the migration data:

```sh
cd LEAP
python3 leap/data_generation/migration_data.py
```
